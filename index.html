<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMILEY LOGISTIQUE +241 - OFFICIEL</title>
    <style>
        :root {
            --gabon-vert: #009E60;
            --gabon-jaune: #FCD116;
            --gabon-bleu: #3A75C4;
            --danger: #e74c3c;
            --dark: #1a1a1a;
            --light: #f8f9fa;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--light); margin: 0; padding: 15px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 10px solid var(--gabon-vert); }
        
        h1 { text-align: center; color: var(--gabon-vert); text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .subtitle { text-align: center; color: var(--gabon-bleu); font-weight: bold; margin-bottom: 25px; }

        /* Navigation */
        nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        nav button { padding: 14px; cursor: pointer; border: none; background: #eee; border-radius: 8px; font-weight: bold; flex: 1; transition: 0.3s; }
        nav button.active { background: var(--gabon-vert); color: white; box-shadow: 0 4px 0 var(--gabon-jaune); }

        /* Formulaire Pro */
        .form-section { background: #f1f3f5; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e0e0e0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: 0.3s; }
        input:focus { border-color: var(--gabon-bleu); outline: none; background: white; }
        .btn-launch { width: 100%; padding: 16px; background: var(--gabon-bleu); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 15px; text-transform: uppercase; }

        /* Tableaux */
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th { background: #333; color: white; padding: 12px; text-align: left; font-size: 13px; text-transform: uppercase; }
        td { border-bottom: 1px solid #eee; padding: 12px; font-size: 14px; }
        
        /* Badges */
        .id-badge { background: var(--dark); color: var(--gabon-jaune); padding: 4px 8px; border-radius: 4px; font-family: 'Courier New', monospace; font-weight: bold; border: 1px solid var(--gabon-jaune); }
        .date-cell { font-size: 12px; color: #666; font-style: italic; }

        /* Cartes de T√¢ches et Re√ßus */
        .card { background: white; border: 1px solid #ddd; border-left: 8px solid var(--gabon-bleu); padding: 18px; margin-bottom: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .card.finalized { border-left-color: var(--gabon-vert); background: #f0fff4; }
        .btn-action { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        .btn-green { background: var(--gabon-vert); }
        .btn-blue { background: var(--gabon-bleu); }
        .btn-red { background: var(--danger); margin-left: 5px; }

        .section { display: none; }
        .active { display: block; }
        
        .summary-box { margin-top: 30px; padding: 25px; background: var(--dark); color: var(--gabon-jaune); border-radius: 12px; text-align: right; box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .summary-box b { font-size: 2.2em; color: white; display: block; }

        .status-tag { font-size: 10px; padding: 3px 6px; border-radius: 4px; text-transform: uppercase; font-weight: bold; }
        .tag-wait { background: #ffeeba; color: #856404; }
        .tag-done { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

<div class="container">
    <h1>CASH & TRANSFERT +241</h1>
    <p class="subtitle">Logistique Smiley - Gabon üá¨üá¶</p>
    
    <nav>
        <button onclick="ouvrir('saisie')" id="tab-saisie" class="active">üìä SAISIE MISSIONS</button>
        <button onclick="ouvrir('taches')" id="tab-taches">üì¶ T√ÇCHES TERRAIN</button>
        <button onclick="ouvrir('re√ßus')" id="tab-re√ßus">üìú RE√áUS & ENCAISSEMENT</button>
    </nav>

    <div id="sec-saisie" class="section active">
        <div class="form-section">
            <div class="form-grid">
                <input type="text" id="mNom" placeholder="Nom du Client">
                <input type="text" id="mLieu" placeholder="Lieu de livraison">
                <input type="number" id="mMontant" placeholder="Montant Retrait">
                <input type="number" id="mCom" placeholder="Commission (FCFA)">
            </div>
            <button class="btn-launch" onclick="creerMission()">Lancer la Mission (N¬∞ Ordre auto)</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>N¬∞ Ordre</th>
                    <th>Date & Heure</th>
                    <th>Client / Lieu</th>
                    <th>Commission</th>
                    <th>√âtat</th>
                </tr>
            </thead>
            <tbody id="body-saisie"></tbody>
        </table>
    </div>

    <div id="sec-taches" class="section">
        <h3 style="color: var(--gabon-bleu); border-bottom: 2px solid #eee; padding-bottom: 10px;">Suivi des livraisons en cours</h3>
        <div id="liste-taches"></div>
    </div>

    <div id="sec-re√ßus" class="section">
        <h3>Journal des Re√ßus & Validation Admin</h3>
        <div id="liste-re√ßus"></div>
        <div class="summary-box">
            TOTAL COMMISSIONS ENCAISS√âES (CONFIRM√â)
            <b id="totalCom">0</b> FCFA
        </div>
    </div>
</div>

<script>
    // Utilisation d'une cl√© de m√©moire unique pour √©viter les conflits
    let db = JSON.parse(localStorage.getItem('SMILEY_DB_PRO_V20') || '[]');
    let cpt = parseInt(localStorage.getItem('SMILEY_CPT_V20') || '0');

    window.onload = () => rafraichir();

    function ouvrir(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
        document.getElementById('tab-' + id).classList.add('active');
        rafraichir();
    }

    function creerMission() {
        const nom = document.getElementById('mNom').value;
        const com = document.getElementById('mCom').value;
        if(!nom || !com) return alert("Veuillez saisir au moins le Nom et la Commission.");

        cpt++;
        const now = new Date();
        const dateStr = now.toLocaleDateString('fr-FR') + " " + now.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});

        db.push({
            id: "OR-" + cpt.toString().padStart(3, '0'),
            date: dateStr,
            nom: nom,
            lieu: document.getElementById('mLieu').value || "-",
            montant: document.getElementById('mMontant').value || "0",
            com: parseFloat(com),
            etape: 1, // 1: Lanc√©, 2: Livr√©, 3: Encaiss√© (Final)
            livreur: ""
        });

        sauvegarder();
        ['mNom', 'mLieu', 'mMontant', 'mCom'].forEach(i => document.getElementById(i).value = "");
        rafraichir();
        alert("Mission enregistr√©e sous le num√©ro " + "OR-" + cpt.toString().padStart(3, '0'));
    }

    function rafraichir() {
        const bS = document.getElementById('body-saisie');
        const lT = document.getElementById('liste-taches');
        const lR = document.getElementById('liste-re√ßus');
        let total = 0;

        bS.innerHTML = ""; lT.innerHTML = ""; lR.innerHTML = "";

        db.forEach((m, i) => {
            // Remplir Tableau Saisie
            bS.innerHTML += `
                <tr>
                    <td><span class="id-badge">${m.id}</span></td>
                    <td class="date-cell">${m.date}</td>
                    <td><b>${m.nom}</b> <br> <small>${m.lieu}</small></td>
                    <td>${m.com.toLocaleString()}</td>
                    <td><span class="status-tag ${m.etape > 1 ? 'tag-done' : 'tag-wait'}">${m.etape > 1 ? 'Livr√©' : 'Attente'}</span></td>
                </tr>`;

            // Remplir Liste T√¢ches Terrain
            if(m.etape === 1) {
                lT.innerHTML += `
                <div class="card">
                    <div>
                        <span class="id-badge">${m.id}</span> <b>${m.nom}</b> - ${m.lieu}<br>
                        <small class="date-cell">Lanc√© le ${m.date} | Montant: ${m.montant} FCFA</small>
                    </div>
                    <button class="btn-action btn-green" onclick="validerLivraison(${i})">VALIDER LIVRAISON</button>
                </div>`;
            }

            // Remplir Liste Re√ßus & Validation
            if(m.etape >= 2) {
                if(m.etape === 3) total += m.com;
                lR.innerHTML += `
                <div class="card ${m.etape === 3 ? 'finalized' : ''}">
                    <div>
                        <span class="id-badge">${m.id}</span> <b>${m.nom}</b> | ${m.com} FCFA<br>
                        <small>Livreur: ${m.livreur} | Date: ${m.date}</small><br>
                        <span style="font-size:11px; font-weight:bold; color:${m.etape === 3 ? 'green' : 'orange'}">
                            ${m.etape === 3 ? '‚óè ENCAISS√â' : '‚óè ATTENTE VALIDATION FINALE'}
                        </span>
                    </div>
                    <div>
                        ${m.etape === 2 ? `<button class="btn-action btn-blue" onclick="validerFinal(${i})">ENCAISSER</button>` : ''}
                        <button class="btn-action btn-red" onclick="supprimer(${i})">X</button>
                    </div>
                </div>`;
            }
        });
        document.getElementById('totalCom').innerText = total.toLocaleString();
    }

    function validerLivraison(i) {
        const mat = prompt("Entrez le matricule du Livreur :");
        if(mat) {
            db[i].etape = 2;
            db[i].livreur = mat;
            sauvegarder();
            rafraichir();
        }
    }

    function validerFinal(i) {
        if(confirm("Confirmer l'encaissement d√©finitif de la mission " + db[i].id + " ?")) {
            db[i].etape = 3;
            sauvegarder();
            rafraichir();
        }
    }

    function supprimer(i) {
        if(confirm("Supprimer d√©finitivement cet enregistrement ?")) {
            db.splice(i, 1);
            sauvegarder();
            rafraichir();
        }
    }

    function sauvegarder() {
        localStorage.setItem('SMILEY_DB_PRO_V20', JSON.stringify(db));
        localStorage.setItem('SMILEY_CPT_V20', cpt);
    }
</script>

</body>
</html>
